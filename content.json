{"meta":{"title":"Hexo","subtitle":"","description":"","author":"John Doe","url":"http://example.com","root":"/"},"pages":[],"posts":[{"title":"","slug":"如何查看宏展开代码","date":"2024-06-16T13:32:42.998Z","updated":"2024-06-16T13:35:17.551Z","comments":true,"path":"2024/06/16/如何查看宏展开代码/","permalink":"http://example.com/2024/06/16/%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E5%AE%8F%E5%B1%95%E5%BC%80%E4%BB%A3%E7%A0%81/","excerpt":"","text":"安装cargo-expand 通过命令 cargo install cargo-expand. 转到对应待查看文件目录，执行cargo expand ITEM ,其中item是指向待查看文件或者模块的路径。若是lib或者bin对应的文件，还需要增加—bin 或者—lib参数，如下：123[[bin]]name = &quot;two-number-adder&quot;path = &quot;src/two_number_adder.rs&quot; two_number_adder.rs 12345678910111213141516171819202122//! 目标：实现一个加法宏add!(1,2) ,输出3//!//声明宏:macro_rules!macro_rules! add &#123; // 第一个分支，匹配两个元素的加法 ($a:expr,$b:expr) =&gt; &#123; $a + $b &#125;; //第二个分支：当只有一个元素时，也应该处理，这是边界情况 ($a:expr) =&gt; &#123; $a &#125;&#125;fn main() &#123; let x = 0; let sum = add!(1,2);//调用宏 let sum = add!(x);&#125; 则展开过程中，需指定bin中定义name: “two-number-adder” 展开后： 12345678910111213141516➜ cargo expand --bin two-number-adder 05/30/24 - 7:11 上午 Checking declarative v0.1.0 (/Users/rui/Rust/RustroverProjects/rust_unit/macro/declarative) Finished dev [unoptimized + debuginfo] target(s) in 0.29s#![feature(prelude_import)]//! 目标：实现一个加法宏add!(1,2) ,输出3//!#[prelude_import]use std::prelude::rust_2021::*;#[macro_use]extern crate std;fn main() &#123; let x = 0; let sum = 1 + 2; let sum = x;&#125; 来看一个过程宏展开实例 12345678910#[derive(Debug)]struct Person &#123; name: String, age: u32,&#125;fn main() &#123;&#125; 展开后如下,自动帮你实现了fmt::Debug 123456789101112131415161718192021222324#![feature(prelude_import)]#[prelude_import]use std::prelude::rust_2021::*;#[macro_use]extern crate std;struct Person &#123; name: String, age: u32,&#125;#[automatically_derived]impl ::core::fmt::Debug for Person &#123; #[inline] fn fmt(&amp;self, f: &amp;mut ::core::fmt::Formatter) -&gt; ::core::fmt::Result &#123; ::core::fmt::Formatter::debug_struct_field2_finish( f, &quot;Person&quot;, &quot;name&quot;, &amp;self.name, &quot;age&quot;, &amp;&amp;self.age, ) &#125;&#125;fn main() &#123;&#125;","categories":[],"tags":[]}],"categories":[],"tags":[]}